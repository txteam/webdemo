/*
 *
 * Wijmo Library 2.3.0
 * http://wijmo.com/
 *
 * Copyright(c) GrapeCity, Inc.  All rights reserved.
 * 
 * Licensed under the Wijmo Commercial License. Also available under the GNU GPL Version 3 license.
 * licensing@wijmo.com
 * http://wijmo.com/widgets/license/
 *
 *
 **/
(function(a){"use strict";var h="wijmo-wijcombobox-input",c="ui-state-hover",d="ui-state-active",b="ui-state-focus",f="ui-corner-left",e="ui-corner-right",i="<div class='wijmo-wijcombobox-trigger ui-state-default ui-corner-right'><span class='ui-icon ui-icon-triangle-1-s'></span></div>",g="<label class='wijmo-wijcombobox-label ui-widget-content'></label>";a.widget("wijmo.wijcombobox",{options:{dataSource:null,data:null,labelText:null,minLength:4,delay:300,showingAnimation:null,hidingAnimation:null,showTrigger:true,triggerPosition:"right",dropdownHeight:300,dropdownWidth:"auto",selectOnItemFocus:false,autoFilter:true,autoComplete:true,highlightMatching:true,dropDownListPosition:{},columns:[],selectionMode:"single",multipleSelectionSeparator:",",forceSelectionText:false,select:null,isEditable:true,selectedIndex:-1,selectedValue:null,inputTextInDropDownList:false,text:null,ensureDropDownOnBody:true,open:null,close:null,selectElementWidthFix:6,search:null,changed:null,listOptions:null},_create:function(){var b=this;b.selectedItem=null;b.selectedItems=[];if(window.wijmoApplyWijTouchUtilEvents)a=window.wijmoApplyWijTouchUtilEvents(a);b._initInnerData();b._createDOMElements();b._bindInputEvents();b._initDropDownList();b.repaint();b._checkSelectIndex();if(b._usingRemoteData()&&b.options.data)b.originalDataSourceLoaded=b.options.data.loaded;b.element.is(":hidden")&&b.element.wijAddVisibilityObserver&&b.element.wijAddVisibilityObserver(function(){b.repaint();b.element.wijRemoveVisibilityObserver&&b.element.wijRemoveVisibilityObserver()},"wijcombobox")},_initInnerData:function(){var a=this,c=a.options,b;if(c.datasource!==null){b=a._isBind();if(b)a.innerData=a._getMappingItems();else a.innerData=c.data}a.listHasCreated=false},_checkSelectIndex:function(){var c=this,d,b=c.options,e=c.innerData;b.selectedIndex===-1&&b.selectedValue&&a.each(e,function(a){if(e[a].value===b.selectedValue){c.options.selectedIndex=a;return false}});d=b.selectedIndex;!c._usingRemoteData()&&(d>=0||a.isArray(d))&&c.search(null,"checkindex");if(b.selectedIndex===-1&&b.text)(!b.forceSelectionText||b.forceSelectionText&&c._checkTextInItems(b.text)!==-1)&&c._input.val(b.text)},repaint:function(){var b=this.options,a=this;if(a.element.is(":visible")||a._comboDiv||a._select!==undefined&&a._input.is(":visible")){a._showTrigger();if(b.disabledState){var c=b.disabled;a.disable();b.disabled=c}b.disabled&&a.disable();return true}return false},_bindInputEvents:function(){var c=this,e,f,g,d;e=c._input;f=c.options;e.bind("keydown.wijcombobox",function(b){if(f.disabledState===true||f.disabled)return;g=b.keyCode;d=a.ui.keyCode;switch(g){case d.UP:c._move("previous",b);b.preventDefault();break;case d.DOWN:c._move("next",b);b.preventDefault();break;case d.ENTER:if(c.menu.active){b.preventDefault();f.selectionMode==="multiple"&&c.menu&&c.menu.items&&c.menu.items.length===1&&a.each(c.selectedItems,function(b,a){if(a!==c.menu.items[0])a.selected=false});c.menu.select(b)}b.preventDefault();break;case d.TAB:e.trigger("wijcomboblur");if(!c.menu.active||f.selectionMode==="multiple"&&d.TAB===g)return;c.menu.select(b);var h=e.val().length;c._selectText(h,h,e);break;case d.ESCAPE:c.close(b);break;case d.LEFT:case d.RIGHT:case d.SHIFT:case 16:case d.CONTROL:case d.HOME:case d.END:case d.DELETE:case d.PAGE_UP:case d.PAGE_DOWN:break;case 18:e.trigger("wijcomboblur");break;default:window.clearTimeout(c.searching);if(f.isEditable===false){if(c._cacheKey===undefined)c._cacheKey="";c._cacheKey+=String.fromCharCode(g)}c.searching=window.setTimeout(function(){var a;if(f.isEditable===false){a=c._cacheKey;c._cacheKey=undefined}else a=e.val();c.search(a,b)},f.delay)}}).bind("wijcomboblur.wijcombobox",function(a){window.clearTimeout(c.searching);c._addInputFocus(false,b);c.closing=window.setTimeout(function(){c.close(a,true)},150)}).bind("focus.wijcombobox",function(){c._addInputFocus(true,b)}).bind("blur.wijcombobox",function(){!c.menu.element.is(":visible")&&e.trigger("wijcomboblur");c._change()})},_addInputFocus:function(f,e){var c=this,d,b,a;d=c._input.parent();b=f?"addClass":"removeClass";a=c._triggerArrow;d[b](e);a!==undefined&&a[b](e)},_renderColumnsHeader:function(c){var b=a("<ul class='wijmo-wijcombobox-rowheader'></ul>");a.each(this.options.columns,function(e,c){var d=a("<li class='wijmo-wijcombobox-cell ui-widget-header'></li>");d.html(c.name);c.width!==undefined&&d.width(c.width);d.appendTo(b)});c.append(b)},_hasSameValueText:function(a,b){return a.label===b.label&&a.value===b.value},_initDropDownList:function(){var b=this,h,d,c,f,e,g;h=b.element[0].ownerDocument;if(!b._comboDiv)d=a("<div class='wijmo-wijcombobox-list'></div>");else d=b._oriList;c=b.options;if(c.columns.length>0){d.addClass("wijmo-wijcombobox-multicolumn");f=a("<div class='wijmo-wijsuperpanel-header ui-state-default'></div>");b._renderColumnsHeader(f);d.append(f)}e={keepHightlightOnMouseLeave:true,selectionMode:c.selectionMode,addHoverItemClass:c.columns.length===0,focus:function(e,d){var a=d;c.selectOnItemFocus&&b.menu.select(null,{notCloseAfterSelected:true});if(c.columns.length>0){a.element.prev().addClass("wijmo-wijcombobox-active-prev");a.element.find(".wijmo-wijcombobox-row>.wijmo-wijcombobox-cell").addClass("ui-state-hover")}},selected:function(i,f){window.clearTimeout(b.closing);var j=c.selectionMode,d,e,h,g;d=f.item;if(b._trigger("select",i,d))if(j==="single"){if(!b._usingRemoteData()){e=a.inArray(d,b.items);if(e===undefined)e=f.selectedIndex;if(e!==c.selectedIndex){b._input.val(d.label);g=b.selectedItem;if(g!==null)g.selected=false;b.selectedItem=d;h=c.selectedIndex;c.selectedIndex=e;c.selectedValue=b.selectedItem.value;if(b._select!==undefined){b._select[0].selectedIndex=c.selectedIndex;b._select.trigger("change")}c.inputTextInDropDownList=true;c.text=b._input.val();g&&g.element&&g.element.removeClass("wijmo-wijcombobox-selecteditem");b._trigger("changed",null,{oldItem:g,selectedItem:b.selectedItem,newIndex:c.selectedIndex,oldIndex:h})}else b.selectedItem&&b._input.val()!==b.selectedItem.label&&(f.data===undefined||!f.data.notCloseAfterSelected)&&b._input.val(d.label)}else if(b.selectedItem===null||!b._hasSameValueText(d,b.selectedItem)){b._input.val(d.label);c.text=b._input.val();b.selectedItem=d;e=a.inArray(d,b.items);if(e===undefined)e=f.selectedIndex;if(e!==c.selectedIndex){c.selectedIndex=e;c.selectedValue=b.selectedItem.value}c.inputTextInDropDownList=true;b._trigger("changed",null,{selectedItem:d})}}else if(!b._usingRemoteData()){b.selectedItems=f.selectedItems;b._selectedItemsToInputVal(b.selectedItems);c.inputTextInDropDownList=true;c.selectedIndex=f.selectedIndex;b._trigger("changed",null,{selectedItem:d,selectedItems:b.selectedItems})}if((f.data===undefined||!f.data.notCloseAfterSelected)&&j==="single"){b.close(i);b._input.focus()}},blur:function(d,b){var a=b.element;if(c.columns.length>0&&a){a.find(".wijmo-wijcombobox-row>.wijmo-wijcombobox-cell").removeClass("ui-state-hover");a.prev().removeClass("wijmo-wijcombobox-active-prev")}},itemRendering:function(g,f){var d=f,e;e="";if(d.isSeparator)e+=" wijmo-wijcombobox-separator";if(d.selected)e+=" wijmo-wijcombobox-selecteditem";e.length>0&&d.element.addClass(e);if(b._keypress&&c.isEditable&&c.columns.length===0&&c.highlightMatching&&a.trim(b._input.val()).length>0&&d.label)d.text=d.label.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+b._escapeRegex(b._input.val())+")(?![^<>]*>)(?![^&;]+;)","gi"),"<span class='ui-priority-primary'>$1</span>");else d.text=undefined},itemRendered:function(g,f){var b=f,d,e;if(b.cells===undefined)return;d=b.element;d.empty();e=a("<ul class='wijmo-wijcombobox-row'></ul>");a.each(b.cells,function(d,f){var b=a("<li class='wijmo-wijcombobox-cell ui-state-default'></li>");if(c.columns&&c.columns.length>d)typeof c.columns[d].width!=="undefined"&&b.width(c.columns[d].width);b.append(f);b.attr("title",f);e.append(b)});d.append(e)},superPanelOptions:{resized:function(){var d=b.menu,a=d.element;c.dropdownWidth=a.outerWidth();c.dropdownHeight=a.outerHeight();b._positionList();b.menu.refreshSuperPanel()}}};e=a.extend(true,e,c.listOptions);g=c.ensureDropDownOnBody?"body":b._comboElement;b.menu=d.appendTo(g,h).wijlist(e).zIndex(b._input.zIndex()+1).css({top:0,left:0}).hide().data("wijlist");b._createDropDownList();b._menuUL=b.menu.ul},_createDropDownList:function(e){var b=this,c,f=b.options,d=e;if(!d)d=b.innerData;if(d===null)c=null;else c=a.isArray(d)?d:d.items;if(b._comboDiv){if(!b.listHasCreated&&c&&c.length>0){b.menu.setTemplateItems(f.data);b.menu.renderList();b.listHasCreated=true}}else if(!b.listHasCreated&&c&&c.length>0){b.menu.setItems(c);b.menu.renderList();b.listHasCreated=true}},_getSelectedItemsText:function(e){var b="",c,d;c=this;d=c.options.multipleSelectionSeparator;c.selectedItems=e;a.each(e,function(c,a){if(a)b+=a.label+d});if(b.length>0)b=b.substr(0,b.lastIndexOf(d));return b},_selectedItemsToInputVal:function(b){var a=this;a._input.val(a._getSelectedItemsText(b));a.options.text=a._input.val()},_createDOMElements:function(){var b=this,e,d,f,g;g=a("<div class='wijmo-wijcombobox-wrapper ui-state-default ui-corner-all'></div>");d=b.element;if(d.is("select")){e=a("<div role='combobox' class='wijmo-wijcombobox ui-widget ui-helper-clearfix'></div>");e.append(g);b._comboElement=e;b._select=d;d.addClass("ui-widget");f=b._input=a("<input role='textbox' aria-autocomplete='list' aria-haspopup='true' />").insertAfter(d);if(!b.options.data){b.options.data=b._convertSelectOptions();b._initInnerData()}}else if(d.is("div")&&a(d.children()[0]).is("input[type='text']")&&a(d.children()[1]).is("div")){b._comboElement=b._comboDiv=e=d;b._oriList=a(d.children()[1]);f=b._input=a(d.children()[0]);g.prependTo(e).append(f);d.addClass("wijmo-wijcombobox ui-widget ui-helper-clearfix");d.attr("role","combobox")}else{e=a("<div role='combobox' class='wijmo-wijcombobox ui-widget ui-helper-clearfix'></div>");e.append(g);b._comboElement=e;f=b._input=d}if(!b._comboDiv){e.insertBefore(f);b.element.is(":visible")&&f.width(f.width());e.children(".wijmo-wijcombobox-wrapper").append(f)}f.attr({autocomplete:"off",role:"textbox","aria-wijcombobox":"list","aria-haspopup":"true"}).addClass(h);b._oldWidth=d.css("width");if(b.options.isEditable===false){f.attr("readonly","readonly");g.bind("click",function(){if(b.options.disabledState===true||b.options.disabled)return;b._triggerClick()})}(b.options.disabledState===true||b.options.disabled===true)&&f.attr("disabled","disabled");e.bind("mouseenter",function(){if(b.options.disabledState===true||b.options.disabled)return;b._addInputFocus(true,c)}).bind("mouseleave",function(){b._addInputFocus(false,c)})},_convertSelectOptions:function(){var d=[],b,c;b=this;c=b._select.get(0).options;a.each(c,function(b,a){d.push({label:a.text,value:a.value})});if(b.options.selectedIndex===-1&&b.options.selectedValue===null&&b.options.text===null)b.options.selectedIndex=b._select[0].selectedIndex;return d},getComboElement:function(){return this._comboElement},_showTrigger:function(){var h=this,l,j,q,p,r,t=0,b,k,o,m,s,n;l=h.options;j=h._input;q=j.parent();p=h._comboElement;b=h._triggerArrow;k=h._label;if(h._select!==undefined){if(!a.browser.msie)t=h._select.width();else{r=h._select.clone();h._select.after(r);t=r.width();r.remove()}j.width(t+(h.innerData.length>20?l.selectElementWidthFix:0));h._select.hide()}j.css("margin-left","");j.css("margin-right","");p.width(q[0].offsetWidth);if(l.labelText!==null){k=h._label=a(g);q.append(k.html(l.labelText))}else if(k!==undefined){k.remove();h._label=undefined}if(l.showTrigger){j.removeClass("ui-corner-all");if(b===undefined){b=h._triggerArrow=a(i);p.append(b);b.bind("mouseover.triggerevent",h,function(d){if(l.disabledState===true||l.disabled)return;var b=a(d.currentTarget);b.addClass(c)}).bind("mousedown.triggerevent",h,function(c){if(l.disabledState===true||l.disabled)return;var b=a(c.currentTarget);b.addClass(d)}).bind("mouseup.triggerevent",h,function(c){var b=a(c.currentTarget);b.removeClass(d)}).bind("click.triggerevent",h,function(){if(l.disabledState===true||l.disabled)return;h._triggerClick()})}if(l.triggerPosition==="right"){b.css({left:"",right:"0px"});b.removeClass(f);b.addClass(e)}else{b.css({right:"",left:"0px"});b.removeClass(e);b.addClass(f)}b.setOutHeight(p.innerHeight());o=b.find("span");o.css("margin-left",(b.innerWidth()-o[0].offsetWidth)/2);o.css("margin-top",(b.innerHeight()-o[0].offsetHeight)/2)}else{if(b!==undefined){b.unbind(".triggerevent");b.remove();h._triggerArrow=undefined}j.removeClass("ui-corner-left");j.removeClass("ui-corner-right");j.addClass("ui-corner-all")}m=s=n=0;if(k!==undefined)s+=k[0].offsetWidth;if(b!==undefined)n=b[0].offsetWidth;m=s+n;j.setOutWidth(q.innerWidth()-m);m=m===0?"":m;if(l.triggerPosition==="right"){j.css("margin-left","");j.css("margin-right",m);if(k!==undefined){k.css("left","");k.css("right",n)}}else{j.css("margin-right","");j.css("margin-left",m);if(k!==undefined){k.css("right","");k.css("left",n)}}},_triggerClick:function(c){var a=this,b="";window.clearTimeout(a.closing);if(a.menu.element.is(":visible"))a.close();else{if(a._usingRemoteData())b=a._input.val();a.search(b,c)}},destroy:function(){var b=this,c=b.element;b.options.isEditable===false&&c.removeAttr("readonly");if(b._select!==undefined){b._select.removeClass("ui-widget");b._select.show();b._input.remove()}else if(b._comboDiv){b._comboDiv.removeClass("wijmo-wijcombobox ui-widget ui-helper-clearfix");b._comboDiv.removeAttr("role");b._input.insertBefore(b._comboDiv);b._comboDiv.children(".wijmo-wijcombobox-wrapper").remove()}else{c.css("width",b._oldWidth);c.removeClass(h);c.removeAttr("autocomplete").removeAttr("role").removeAttr("aria-wijcombobox").removeAttr("aria-haspopup");c.insertBefore(b._comboElement);c.css("padding","")}b._comboElement.remove();b.menu.destroy();b.menu.element.remove();a.Widget.prototype.destroy.call(b)},_setOption:function(f,e){var b=this,n,j,d,o,i=b._label,l,h,k=null,m=0,c=b.options;n=b._comboElement;j=b.element;o=j.parent();h=c.selectedIndex;if(b._triggerArrow)m=b._triggerArrow.outerWidth();a.Widget.prototype._setOption.apply(b,arguments);if(f==="disabled")if(e){n.addClass("wijmo-wijcombobox-disabled ui-state-disabled");b._input.attr("disabled","disabled");b._comboDiv&&b._input.addClass("wijmo-wijcombobox-disabled ui-state-disabled").attr("disabled","disabled");b._triggerArrow&&b._triggerArrow.unbind("click.triggerevent");b.close()}else{n.removeClass("wijmo-wijcombobox-disabled ui-state-disabled");b._input.removeAttr("disabled");b._comboDiv&&b._input.removeClass("wijmo-wijcombobox-disabled ui-state-disabled").removeAttr("disabled");b._triggerArrow&&b._triggerArrow.bind("click.triggerevent",b,function(){if(c.disabledState===true)return;b._triggerClick()})}else if(f==="labelText"){if(c.labelText!==null){i=b._label=a(g);b._input.parent().append(i.html(c.labelText));if(b._triggerArrow!==undefined)l=b._triggerArrow[0].offsetWidth;if(c.triggerPosition==="right"){if(i!==undefined){i.css("left","");i.css("right",l)}}else if(i!==undefined){i.css("right","");i.css("left",l)}b.repaint()}else if(i!==undefined){i.remove();b._label=undefined}}else if(f==="showTrigger"){b._showTrigger();!c.showTrigger&&b.element.is("select")&&j.width(j.width()+m)}else if(f==="triggerPosition"){j.width(j.width()+m);b._showTrigger()}else if(f==="selectionMode")b.menu._setOption("selectionMode",e);else if(f==="isEditable")if(e){b._input.removeAttr("readonly");a(".wijmo-wijcombobox-wrapper",b._comboElement[0]).bind("click",function(){b._triggerClick()})}else{b._input.attr("readonly","readonly");a(".wijmo-wijcombobox-wrapper",b._comboElement[0]).unbind("click")}else if(f==="data"||f==="dataSource"){b._initInnerData();b._setSelectedIndex(c.selectedIndex);if(a.isArray(b.innerData)){b.listHasCreated=false;b._createDropDownList()}else try{b.innerData.loaded=function(c){if(c===null)b.items=null;else b.items=a.isArray(c)?c:c.items;b.listHasCreated=false;b._createDropDownList()};b.innerData.load(null)}catch(p){}if(c.selectedIndex!==-1){k=d?d[h]:null;d=b.innerData;b._trigger("changed",null,{oldItem:k,selectedItem:b.selectedItem,newIndex:c.selectedIndex,oldIndex:h})}}else if(f==="selectedIndex"){if(e===h)return;if(e>-1){if(b.selectedItem&&b.selectedItem.selected!==undefined)b.selectedItem.selected=false;d=b.innerData;if(h&&h!==-1&&d[h])d[h].selected=false;if(d&&d[e]!==null){b.selectedItem=d[e];if(b.selectedItem){b.selectedItem.selected=true;b._input.val(b.selectedItem.label);c.selectedValue=b.selectedItem.value;c.inputTextInDropDownList=true;c.text=b._input.val()}}}else if(e<=-1||!e){c.inputTextInDropDownList=false;b._clearSelection()}k=d?d[h]:null;b._trigger("changed",null,{oldItem:k,selectedItem:b.selectedItem,newIndex:c.selectedIndex,oldIndex:h})}else if(f==="selectedValue")if(e){if(b.selectedItem&&b.selectedItem.selected!==undefined)b.selectedItem.selected=false;d=b.items;if(!d)d=b.innerData;a.each(d,function(a){if(d[a].value===e){b.selectedItem=d[a];b.selectedItem.selected=true;b._input.val(b.selectedItem.label);b.options.selectedIndex=a;c.inputTextInDropDownList=true;c.text=b._input.val();return false}})}else{c.inputTextInDropDownList=false;b._clearSelection()}else if(f==="text"){if(c.forceSelectionText&&b._checkTextInItems(e)===-1)return;b._input.val(e)}},_setSelectedIndex:function(b){var a=this,c=a.options;if(b===null||b===undefined)return;if(b===-1){a.selectedItem=null;c.selectedIndex=-1;c.selectedValue=null;if(c.text)a._input.val(c.text);else a._input.val("")}else if(a.innerData&&a.innerData[b]!==null&&a.innerData[b]!==undefined){a.innerData[b].selected=true;a._input.val(a.innerData[b].label)}c.text=a._input.val()},search:function(h,d){var b=this,g,c,e,f;g=b.options;c=b.innerData;window.clearTimeout(b.closing);e={value:h,e:d,self:b};if(c!==null||b._comboDiv){f=b._isBind();if(d!=="checkindex")if(b._trigger("search",d,{datasrc:c,term:e})===false)return;if(a.isArray(c)||f||b._comboDiv){b._hideShowArrow(false);b._onListLoaded(c,e)}else if(!f&&a.isArray(g.dataSource))return;else{if(b._usingRemoteData()&&d!==undefined&&h.length<g.minLength)return;b._hideShowArrow(false);c.loaded=function(a,c){b.listHasCreated=false;b._createDropDownList(a);b._onListLoaded(a,c);b.originalDataSourceLoaded&&b.originalDataSourceLoaded(a,c)};c.load(e)}}},_isBind:function(){var b=this.options,a=b.data;return a!==null&&a.label&&a.label.bind?true:false},_getMappingItems:function(){var g=this.options,c=g.dataSource,b=g.data,d,e,f;if(!c||!b)return null;if(!b.label||!b.label.bind||!b.value||!b.value.bind)return null;e=b.label.bind;f=b.value.bind;if(c&&c.length!==0){d=[];a.each(c,function(b,a){d.push({label:a[e],value:a[f]})});return d}return null},_clearSelection:function(){var b=this,c=b.options;if(c.selectionMode==="single"){if(b.selectedItem!==null)b.selectedItem.selected=false;b.selectedItem=null}else if(b.selectedItems){a.each(b.selectedItems,function(b,a){if(a.selected)a.selected=false});b.selectedItem=null;b.selectedItems=null}c.selectedValue=null;b._input.val("");c.text=b._input.val()},_usingRemoteData:function(){var b=this.options.data,c=false;if(!a.isArray(b)&&b!==null&&b.proxy)c=true;return c},_hideShowArrow:function(d){var c=this,b,a;b=c.element;a=c._triggerArrow;a!==undefined&&a[d?"show":"hide"]();b[d?"removeClass":"addClass"]("wijmo-wijcombobox-loading")},_onListLoaded:function(g,h){var c=h.self,k,i,j,d,f,e;k=c._input;i=c.options;j=h.value;if(g===null)d=null;else d=a.isArray(g)?g:g.items;c.items=d;if(h.e==="checkindex"){f=i.selectedIndex;if(i.selectionMode==="multiple"&&a.isArray(f)){a.each(f,function(e,b){var a=d[b];a.selected=true;c.selectedItems.push(a)});c._selectedItemsToInputVal(c.selectedItems)}else{d[f].selected=true;c.selectedItem=d[f];k.val(c.selectedItem.label)}c._hideShowArrow(true);return}if(!c._usingRemoteData()&&d)e=d;else{c._topHit=null;e=d}if(e&&e.length>0||c._comboDiv){c._openlist(e,h,j);c._trigger("open");c._addInputFocus(true,b)}else c.close(null,true);c._hideShowArrow(true)},close:function(h,g){var e=this,d,c,f;d=e.menu;e._dropDownHeight=d.element.outerHeight();e._dropDownWidth=d.element.outerWidth();window.clearTimeout(e.closing);if(d.element.is(":visible")&&!d.element.is(":animated")&&!d.element.parent().is(":animated")){e._trigger("close",h);d.deactivate();c=e.options.hidingAnimation;if(c&&(c.effect==="size"||c.animated==="size"))c.options=a.extend({to:{width:0,height:0}},c.options);f=d.element.attr("style");if(g!==true&&c)d.element.hide(c.effect||c.animated,c.options,c.speed||c.duration,function(){d.element.removeAttr("style").attr("style",f).hide();c.callback&&c.callback.apply(this,arguments)});else d.element.hide();e._addInputFocus(false,b);a(document).unbind("mouseup",e.closeOnClick)}},_change:function(){var a=this,b,k,g,f,d,c,i,j,h,e=-1;b=a.options;k=b.forceSelectionText;g=b.selectionMode;f=a._input;d=f.val();c=a.selectedItem;i=a.selectedItems;j=a.selectedIndex;h=a.innerData;if(k){if(g==="single")if(c!==null)c.label!==d&&f.val(c.label);else f.val("")}else if(g==="single")if(!c&&d!==""||c!==null&&c.label!==d){if(a.selectedItem!==null)a.selectedItem.selected=false;e=a._checkTextInItems(d);if(e===-1){a.selectedItem=null;b.selectedIndex=-1;b.selectedValue=null;b.inputTextInDropDownList=false}else if(h){a.selectedItem=h[e];b.selectedIndex=e;b.selectedValue=a.selectedItem.value;b.inputTextInDropDownList=true}b.text=a._input.val();a._trigger("changed",null,{oldItem:c,selectedItem:a.selectedItem,newIndex:b.selectedIndex,oldIndex:j})}if(g==="multiple"){if(!a.selectedItems||a.selectedItems.length===0)i=[c];a._selectedItemsToInputVal(i)}},_checkTextInItems:function(d){var e=this,c=-1,b=e.innerData;d&&a.each(b,function(a){if(b[a]&&b[a].label&&b[a].label===d){c=a;return false}});return c},_openlist:function(t,q,g){var b=q.self,f=q.e,i,h,c,e,p,s=2,m=0,l,k,r,d,n,o,j=false;i=b._keypress=!!f;e=b.options;c=b.menu.element;c.zIndex(b.element.zIndex()+100);if(g!==null&&g!==undefined){j=b._keypress&&e.isEditable&&e.columns.length===0&&e.highlightMatching&&a.trim(b._input.val()).length>0;b._topHit=b.menu.filterItems(g,e.autoFilter,j)}b.menu.element.show();if(e.dropdownWidth==="auto")h=b._comboElement.outerWidth();else h=e.dropdownWidth;p=c.css("padding");c.css("padding","0px");c.setOutWidth(h);c.css("padding",p);l=e.dropdownHeight;if(c.children(".wijmo-wijsuperpanel-header"))m=c.children(".wijmo-wijsuperpanel-header").outerHeight()||0;r=Math.min(b._menuUL.outerHeight()+s+m,l);c.setOutHeight(r);b.menu.refreshSuperPanel();b._positionList();!i&&b.selectedItem!==undefined&&b.menu.activate(null,b.selectedItem,true);if(i&&f.keyCode!==a.ui.keyCode.BACKSPACE)if(e.isEditable)b._runAutoComplete();else b.menu.activate(null,b._topHit,true);else{d=b.options.showingAnimation;if(e.showingAnimation!==null&&!(f!==undefined&&f.keyCode===a.ui.keyCode.BACKSPACE)){b.menu.element.hide();o={from:{width:0,height:0},to:{width:b._dropDownWidth||c.outerWidth(),height:b._dropDownHeight||c.outerHeight()}};if(d&&(d.effect==="size"||d.animated==="size"))d.options=a.extend(o,d.options);n=c.attr("style");c.show(d.effect||d.animated,d.options,d.speed||d.duration,function(){c.removeAttr("style").attr("style",n).show();d.callback&&d.callback.apply(this,arguments);a.browser.msie&&c.css("filter","")})}}if(!b.hasOwnProperty("closeOnClick")){k=b.closeOnClick;b.closeOnClick=function(a){return k(a)}}a(document).bind("mouseup",b,b.closeOnClick)},closeOnClick:function(c){var b=c.data,d=c.target;if(!a.contains(b._comboElement[0],d)&&!a.contains(b.menu.element[0],d)){b.close();a(".wijmo-wijcombobox-wrapper",b._comboElement[0]).removeClass("ui-state-hover").removeClass("ui-state-focus");a(".wijmo-wijcombobox-trigger",b._comboElement[0]).removeClass("ui-state-hover").removeClass("ui-state-focus")}},_positionList:function(){var c=this,d,b;d=c.options.dropDownListPosition;b={my:"left top",at:"left bottom",of:c._comboElement,collision:"none"};b=a.extend(b,d);c.menu.element.position(b)},_runAutoComplete:function(){var b=this,c,a,e,d,f,g;c=b._input;a=b._topHit;if(!b.options.autoComplete||a===null||a===undefined)return;b.menu.activate(null,a,true);e=c.val();d=a.label;c.val(d);f=e.length;g=d.length;b._selectText(f,g,c)},_selectText:function(d,e,c){var f=c.val(),a=c.get(0),b;if(f.length>0)if(a.setSelectionRange!==undefined)a.setSelectionRange(d,e);else if(a.createTextRange!==undefined){b=a.createTextRange();b.moveStart("character",d);b.moveEnd("character",e-f.length);b.select()}},_move:function(a,b){if(!this.menu.element.is(":visible")){this.search("",b);return}if(this.menu.first()&&/^previous/.test(a)||this.menu.last()&&/^next/.test(a))return;this.menu[a](b)},_escapeRegex:function(a){return a===undefined?a:a.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")},_filter:function(c,f){var d=this._escapeRegex(f),e,b=null;if(!c)return null;e=new RegExp(d,"i");a.each(c,function(f,a){if(d===undefined||d.length===0){a.match=true;return}var c=e.exec(a.label);if(c===null)a.match=false;else{if(b===null&&c.index===0)b=a;a.match=c.index>=0}});this._topHit=b;return c}})})(jQuery);